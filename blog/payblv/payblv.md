基于业务逻辑的支付漏洞
===

### 原理

#### 优惠券

电商中常见的优惠券有几种:
-   第一种, 也是最常见的是 "满减" 形式的优惠券, 也就是**打折券**。这种优惠券一般来说只是一种营销手段, 再结合事先提高价格一类的操作实现营销目的。
-   第二种则是**无门槛**优惠券, 显然当原价低于优惠金额时, 就能实现 "零元购", 所以这种优惠券通常会施加某些**限制**, 比如平台会有限定商品范围, 或者只能使用一张。在这些限制下，第二种优惠券就和第一种优惠券**实质上相同**。
-   第三种是拼多多等软件中的 "返现" 活动。

> 优惠券本身并不是漏洞, 而是一种常见的商业营销手段。但是无门槛优惠券**缺乏某些限制**时, 就可能导致大量商品以低价甚至 0 元成交, 这就形成了漏洞。

最常见的例子是, 无门槛优惠券**没有叠加限制**, 那么一旦持有足够数量的无门槛券, 就可以免费获取商品。这种优惠券常常在平台竞争激烈的时候出现, 平台会用短期利润来换取用户市场, 从而投放一些无门槛优惠券。

#### 支付流程

假设现在要购买某件商品, 存在以下两种流程:




